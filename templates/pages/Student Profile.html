{% load static %}
{% include "base.html" %}
{% block content %}
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <i class="bi bi-mortarboard me-2" style="font-size: 1.5rem;"></i>
                <span>منصة مشاريع التخرج</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{%url 'index' %}">الرئيسية</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{%url 'MyProject'%}">مشاريعي</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{%url 'studentProfile'%}">حسابي</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-light text-primary ms-2" href="{%url 'logout'%}">خروج</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar p-3">
                <div class="position-sticky">
                    <div class="profile-header">
                        <div class="profile-avatar mx-auto">
                            <i class="bi bi-person-fill"></i>
                        </div>
                        <h4 class="mt-2">{{user.fullname}}</h4>
                        <p class="mb-0">طالب - {{user.department.major_name}} </p>
                    </div>
                    
                    <ul class="nav flex-column mt-3">
                        <li class="nav-item mb-2">
                            <a class="nav-link active" href="#">
                                <i class="bi bi-person me-2"></i>
                                الملف الشخصي
                            </a>
                        </li>
                        <li class="nav-item mb-2">
                            <a class="nav-link" href="{%url 'MyProject' %}">
                                <i class="bi bi-journal-text me-2"></i>
                                مشاريعي
                            </a>
                        </li>
                    </ul>
                    <hr class="my-4">
                    <h6 class="text-muted">إحصائياتي</h6>
                    <div class="row g-2 mt-3">
                        <div class="col-6 col-md-12 col-lg-6 col-xl-12">
                            <div class="stats-card mb-2">
                                <i class="bi bi-mortarboard text-primary"></i>
                                <h6 class="mt-2 mb-1">المشاريع</h6>
                                <h4 class="mb-0">{{countOfProjects}}</h4>
                            </div>
                        </div>
                        <div class="col-6 col-md-12 col-lg-6 col-xl-12">
                            <div class="stats-card mb-2">
                                <i class="bi bi-star-fill text-warning"></i>
                                <h6 class="mt-2 mb-1">التقييم</h6>
                                <h4 class="mb-0">4.3</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Main Content Area -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>الملف الشخصي</h2>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editProfileModal">تعديل الملف</button>
                </div>
                
                <!-- Profile Info -->
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card shadow-sm mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-4">معلوماتي الشخصية</h5>
                                
                                <div class="d-flex align-items-center mb-4">
                                    <div class="badge bg-primary rounded-pill p-2 me-3">
                                        <i class="bi bi-person fs-4"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0">{{user.fullname}}</h6>
                                        <small class="text-muted">الاسم الكامل</small>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-center mb-4">
                                    <div class="badge bg-primary rounded-pill p-2 me-3">
                                        <i class="bi bi-envelope fs-4"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0">{{user.email}}</h6>
                                        <small class="text-muted">البريد الإلكتروني</small>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-center mb-4">
                                    <div class="badge bg-primary rounded-pill p-2 me-3">
                                        <i class="bi bi-building fs-4"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0">{{user.university.univ_name}}</h6>
                                        <small class="text-muted">الجامعة</small>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-center mb-4">
                                    <div class="badge bg-primary rounded-pill p-2 me-3">
                                        <i class="bi bi-journal-code fs-4"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0">{{user.department.major_name}}</h6>
                                        <small class="text-muted">التخصص</small>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-center mb-4">
                                    <div class="badge bg-primary rounded-pill p-2 me-3">
                                        <i class="bi bi-calendar fs-4"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0">{{user.grade_year}}</h6>
                                        <small class="text-muted">سنة التخرج</small>
                                    </div>
                                </div>
                                
                                <div class="d-flex align-items-center">
                                    <div class="badge bg-primary rounded-pill p-2 me-3">
                                        <i class="bi bi-hash fs-4"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-0">{{user.student_id}}</h6>
                                        <small class="text-muted">رقم الطالب</small>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                        
                        <!-- Projects Section -->
                        <div class="card shadow-sm mb-4">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">مشاريعي</h5>
                                <a href="#" class="btn btn-sm btn-outline-primary">عرض الكل</a>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    
                                    <!-- Project Item -->
                                    {% for project in projects %}
                                    <div class="col-md-6">
                                        <div class="card project-card h-100 shadow-sm">
                                            <div class="project-image position-relative">
                                                <img src="https://via.placeholder.com/300x150?text= مشروع+2" alt="مشروع {{forloop.counter}}">
                                            </div>
                                            <div class="card-body p-3">
                                                <h6 class="card-title mb-1">{{project.ProjectName}}</h6>
                                                <p class="card-text text-muted mb-1">{{project.MajorID.major_name}}</p>
                                                <div class="rating-stars">
                                                    {{project.rates}}
                                                </div>
                                                <div class="rating-stars">
                                                   الدرجة : {{project.degree}} 
                                                </div>
                                                <div class="rating-stars">
                                                   الحالة : {{project.status}} 
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Column -->
                    <div class="col-lg-4">
                        <!-- About Me Card -->
                        <div class="card shadow-sm mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-4">عن نفسي</h5>
                                
                                <p class="card-text text-muted">{{notes}}</p>
                                
                                <h6 class="mt-4 mb-3">المهارات</h6>
                                <div class="d-flex flex-wrap gap-2">
                                    {% for skill in skills %}
                                    <span class="badge bg-primary">{{skill.skill}}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProfileModalLabel">تعديل الملف الشخصي</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="POST" enctype="multipart/form-data"> 
                        {% csrf_token %}
                        <h6 class="mb-3">المعلومات الشخصية</h6>
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="fullName" class="form-label">الاسم الكامل</label>
                                <input type="text" class="form-control"  id="fullName" value="{{user.fullname}}" disabled>
                            </div>
                            <div class="col-md-6">
                                <label for="studentId" class="form-label">رقم الطالب</label>
                                <input type="text" class="form-control" id="studentId" value="{{user.student_id}}" disabled>
                            </div>
                            <div class="col-md-6">
                                <label for="university" class="form-label">الجامعة</label>
                                <input type="text" class="form-control" id="university" value="{{user.university.univ_name}}" disabled>
                            </div>
                            <div class="col-md-6">
                                <label for="major" class="form-label">التخصص</label>
                                <input type="text" class="form-control" id="major" value="{{user.department.major_name}}" disabled>
                            </div>
                            <div class="col-md-6">
                                <label for="major" class="form-label">سنة التخرج</label>
                                <input type="text" class="form-control" id="major" value="{{user.grade_year}}" disabled>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label">البريد الإلكتروني</label>
                                <input type="email" class="form-control" id="email" value="{{user.email}}" disabled>
                            </div>
                        </div>
                        
                        <h6 class="mb-3">المهارات</h6>
                        <div class="mb-4">
                            <div class="d-flex mb-2">
                                <input type="text" class="form-control me-2" name="skills" placeholder="يرجى وضع (,) بين المهارة و الأخرى">
                                <button type="button" class="btn btn-outline-primary btn-sm" style="width: 40px;">
                                    <i class="bi bi-plus"></i>
                                </button>
                            </div>
                        </div>
                        
                        <h6 class="mb-3">نبذة عني</h6>
                        <div class="mb-4">
                            <textarea class="form-control" rows="3" name="note" placeholder="اكتب نبذة عن نفسك هنا..."></textarea>
                        </div>
                        
                        <h6 class="mb-3">تعديل كلمة المرور</h6>
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="currentPassword" class="form-label">كلمة المرور الحالية</label>
                                <input type="password" class="form-control" id="currentPassword" name="currentPassword">
                            </div>
                            <div class="col-md-6">
                                <label for="newPassword" class="form-label">كلمة المرور الجديدة</label>
                                <input type="password" class="form-control" id="newPassword" name="newPassword">
                            </div>
                            <div class="col-md-6">
                                <label for="confirmPassword" class="form-label">تأكيد كلمة المرور</label>
                                <input type="password" class="form-control" id="confirmPassword" name="sure">
                            </div>
                        </div>
                                        <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <input type="submit" class="btn btn-primary" value="حفظ التغييرات">
                </div>
                    </form>
                </div>

            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">© 2025 منصة مشاريع التخرج - جميع الحقوق محفوظة</p>
        </div>
    </footer>
{% endblock %}