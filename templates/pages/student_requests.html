{% load static %}
{% include "base.html" %}
{% block content %}
    <link rel="stylesheet" href="{% static 'css/student_requests.css' %}">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <i class="bi bi-mortarboard me-2" style="font-size: 1.5rem;"></i>
                <span>منصة مشاريع التخرج</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'index' %}">الرئيسية</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'BrowseProjects' %}">المشاريع</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{% url 'student_requests' %}">طلبات الطلاب</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-light text-primary ms-2" href="{% url 'logout' %}">خروج</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid h-100">
        <div class="row h-100">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar p-4">
                <div class="position-sticky">
                    <h5 class="mb-3">القائمة</h5>
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2">
                            <a class="nav-link" href="{% url 'index' %}">
                                <i class="bi bi-person-lines-fill me-2"></i>
                                لوحة التحكم
                            </a>
                        </li>
                        <li class="nav-item mb-2">
                            <a class="nav-link" href="{% url 'BrowseProjects' %}">
                                <i class="bi bi-journal-text me-2"></i>
                                مشاريع للتصحيح
                            </a>
                        </li>
                        <li class="nav-item mb-2">
                            <a class="nav-link active" href="{% url 'student_requests' %}">
                                <i class="bi bi-people me-2"></i>
                                طلبات الطلاب
                            </a>
                        </li>
                        <li class="nav-item mb-2">
                            <a class="nav-link" href="#">
                                <i class="bi bi-gear me-2"></i>
                                إعدادات الحساب
                            </a>
                        </li>
                    </ul>
                    
                    <hr class="my-4">
                    
                    <h6 class="text-muted">الإحصائيات</h6>
                    <div class="mt-3">
                        <p class="mb-1">الطلبات الجديدة: <strong>5</strong></p>
                        <p class="mb-1">الطلبات المقبولة: <strong>12</strong></p>
                        <p class="mb-0">الطلبات المرفوضة: <strong>3</strong></p>
                    </div>
                </div>
            </nav>

            <!-- Main Content Area -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="d-flex align-items-center my-2 flex-column">
                        <h2>طلبات الطلاب</h2>
                        <h4>الطلبات المعلقة للموافقة:</h4>
                    </div>
                    <form method="POST" enctype="multipart/form-data"> 
                        {% csrf_token %}
                        <div class="d-flex gap-2">
                            <select class="form-select" style="width: auto;" name="statusFilter">
                                <option value="all" selected>جميع الطلبات</option>
                                <option value="pending">طلبات جديدة</option>
                                <option value="accepted">مقبولة</option>
                                <option value="rejected">مرفوضة</option>
                            </select>
                            <button type="submit" name="filter" class="btn btn-primary">تصفية</button>
                        </div>
                    </form>
                </div>
                
                <!-- Requests Grid -->
                <div class="row g-4 h-100">
                    <!-- Request Card 1 -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card project-card h-100 shadow-sm">
                            <div class="project-image position-relative">
                                <img src="https://via.placeholder.com/400x150?text=طلب+1" alt="طلب 1">
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title mb-2">نظام إدارة المستشفيات</h5>
                                <p class="card-text text-muted mb-3">نظام متكامل لإدارة المستشفيات يشمل إدارة المرضى والمواعيد والسجلات الطبية.</p>
                                <div class="student-info mb-3">
                                    <p class="mb-1"><strong>الطالب:</strong> أحمد محمد</p>
                                    <p class="mb-1"><strong>التخصص:</strong> علوم الحاسب</p>
                                    <p class="mb-1"><strong>التاريخ:</strong> 2024-03-15</p>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-auto">
                                    <span class="badge bg-warning">قيد الانتظار</span>
                                    <div class="btn-group">
                                        <button class="btn btn-success btn-sm confirm-btn" data-request-id="1">
                                            قبول
                                        </button>
                                        <button class="btn btn-danger btn-sm reject-btn" data-request-id="1">
                                            رفض
                                        </button>
                                        <button class="btn btn-primary btn-sm view-details-btn" data-bs-toggle="modal" data-bs-target="#">
                                            التفاصيل
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Request Card 2 -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card project-card h-100 shadow-sm">
                            <div class="project-image position-relative">
                                <img src="https://via.placeholder.com/400x150?text=طلب+2" alt="طلب 2">
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title mb-2">تطبيق تجارة إلكترونية</h5>
                                <p class="card-text text-muted mb-3">تطبيق متكامل للتجارة الإلكترونية مع نظام دفع إلكتروني وإدارة مخزون.</p>
                                <div class="student-info mb-3">
                                    <p class="mb-1"><strong>الطالب:</strong> فاطمة عبدالله</p>
                                    <p class="mb-1"><strong>التخصص:</strong> نظم المعلومات</p>
                                    <p class="mb-1"><strong>التاريخ:</strong> 2024-03-14</p>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-auto">
                                    <span class="badge bg-warning">قيد الانتظار</span>
                                    <div class="btn-group">
                                        <button class="btn btn-success btn-sm confirm-btn" data-request-id="2">
                                            قبول
                                        </button>
                                        <button class="btn btn-danger btn-sm reject-btn" data-request-id="2">
                                            رفض
                                        </button>
                                        <button class="btn btn-primary btn-sm view-details-btn" data-bs-toggle="modal" data-bs-target="#">
                                            التفاصيل
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Request Card 3 -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card project-card h-100 shadow-sm">
                            <div class="project-image position-relative">
                                <img src="https://via.placeholder.com/400x150?text=طلب+3" alt="طلب 3">
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title mb-2">منصة تعليمية ذكية</h5>
                                <p class="card-text text-muted mb-3">منصة تعليمية تستخدم الذكاء الاصطناعي لتقديم محتوى تعليمي مخصص للطلاب.</p>
                                <div class="student-info mb-3">
                                    <p class="mb-1"><strong>الطالب:</strong> خالد سعيد</p>
                                    <p class="mb-1"><strong>التخصص:</strong> هندسة البرمجيات</p>
                                    <p class="mb-1"><strong>التاريخ:</strong> 2024-03-13</p>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-auto">
                                    <span class="badge bg-warning">قيد الانتظار</span>
                                    <div class="btn-group">
                                        <button class="btn btn-success btn-sm confirm-btn" data-request-id="3">
                                            قبول
                                        </button>
                                        <button class="btn btn-danger btn-sm reject-btn" data-bs-toggle="modal" data-bs-target="#">
                                            رفض
                                        </button>
                                        <button class="btn btn-primary btn-sm view-details-btn" data-bs-toggle="modal" data-bs-target="#">
                                            التفاصيل
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Request Card 4 -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card project-card h-100 shadow-sm">
                            <div class="project-image position-relative">
                                <img src="https://via.placeholder.com/400x150?text=طلب+4" alt="طلب 4">
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title mb-2">نظام مراقبة ذكي</h5>
                                <p class="card-text text-muted mb-3">نظام مراقبة باستخدام كاميرات ذكية قادرة على تحليل الحركة والتعرف على الوجوه.</p>
                                <div class="student-info mb-3">
                                    <p class="mb-1"><strong>الطالب:</strong> سارة علي</p>
                                    <p class="mb-1"><strong>التخصص:</strong> أمن المعلومات</p>
                                    <p class="mb-1"><strong>التاريخ:</strong> 2024-03-12</p>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-auto">
                                    <span class="badge bg-success">مقبول</span>
                                    <div class="btn-group">
                                        <button class="btn btn-success btn-sm confirm-btn" data-request-id="4" disabled>
                                            قبول
                                        </button>
                                        <button class="btn btn-danger btn-sm reject-btn" data-request-id="4" disabled>
                                            رفض
                                        </button>
                                        <button class="btn btn-primary btn-sm view-details-btn" data-bs-toggle="modal" data-bs-target="#">
                                            التفاصيل
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Request Card 5 -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card project-card h-100 shadow-sm">
                            <div class="project-image position-relative">
                                <img src="https://via.placeholder.com/400x150?text=طلب+5" alt="طلب 5">
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title mb-2">تطبيق إدارة المهام</h5>
                                <p class="card-text text-muted mb-3">تطبيق لإدارة المهام الشخصية والمشاريع مع ميزات التعاون بين الفرق.</p>
                                <div class="student-info mb-3">
                                    <p class="mb-1"><strong>الطالب:</strong> محمد حسن</p>
                                    <p class="mb-1"><strong>التخصص:</strong> علوم الحاسب</p>
                                    <p class="mb-1"><strong>التاريخ:</strong> 2024-03-11</p>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-auto">
                                    <span class="badge bg-danger">مرفوض</span>
                                    <div class="btn-group">
                                        <button class="btn btn-success btn-sm confirm-btn" data-request-id="5" disabled>
                                            قبول
                                        </button>
                                        <button class="btn btn-danger btn-sm reject-btn" data-request-id="5" disabled>
                                            رفض
                                        </button>
                                        <button class="btn btn-primary btn-sm view-details-btn" data-bs-toggle="modal" data-bs-target="#">
                                            التفاصيل
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Request Card 6 -->
                    <div class="col-md-6 col-lg-4">
                        <div class="card project-card h-100 shadow-sm">
                            <div class="project-image position-relative">
                                <img src="https://via.placeholder.com/400x150?text=طلب+6" alt="طلب 6">
                            </div>
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title mb-2">منصة سياحة وسفر</h5>
                                <p class="card-text text-muted mb-3">منصة شاملة لحجوزات الفنادق والطيران وتخطيط رحلات السياحة.</p>
                                <div class="student-info mb-3">
                                    <p class="mb-1"><strong>الطالب:</strong> نورا عبدالرحمن</p>
                                    <p class="mb-1"><strong>التخصص:</strong> نظم المعلومات</p>
                                    <p class="mb-1"><strong>التاريخ:</strong> 2024-03-10</p>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-auto">
                                    <span class="badge bg-warning">قيد الانتظار</span>
                                    <div class="btn-group">
                                        <button class="btn btn-success btn-sm confirm-btn" data-request-id="6">
                                            قبول
                                        </button>
                                        <button class="btn btn-danger btn-sm reject-btn" data-request-id="6">
                                            رفض
                                        </button>
                                        <button class="btn btn-primary btn-sm view-details-btn" data-bs-toggle="modal" data-bs-target="#">
                                            التفاصيل
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0">© 2025 منصة مشاريع التخرج - جميع الحقوق محفوظة</p>
        </div>
    </footer>

    <!-- JavaScript for Request Actions -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Confirm button functionality
            document.querySelectorAll('.confirm-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = this.getAttribute('data-request-id');
                    if (!this.disabled) {
                        if (confirm('هل أنت متأكد من قبول هذا الطلب؟')) {
                            // Update UI immediately
                            const card = this.closest('.project-card');
                            const badge = card.querySelector('.badge');
                            badge.className = 'badge bg-success';
                            badge.textContent = 'مقبول';
                            
                            // Disable action buttons
                            card.querySelectorAll('.confirm-btn, .reject-btn').forEach(btn => {
                                btn.disabled = true;
                            });
                            
                            // Here you would typically send an AJAX request to update the status in the database
                            console.log(`Request ${requestId} accepted`);
                        }
                    }
                });
            });

            // Reject button functionality
            document.querySelectorAll('.reject-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = this.getAttribute('data-request-id');
                    if (!this.disabled) {
                        if (confirm('هل أنت متأكد من رفض هذا الطلب؟')) {
                            // Update UI immediately
                            const card = this.closest('.project-card');
                            const badge = card.querySelector('.badge');
                            badge.className = 'badge bg-danger';
                            badge.textContent = 'مرفوض';
                            
                            // Disable action buttons
                            card.querySelectorAll('.confirm-btn, .reject-btn').forEach(btn => {
                                btn.disabled = true;
                            });
                            
                            // Here you would typically send an AJAX request to update the status in the database
                            console.log(`Request ${requestId} rejected`);
                        }
                    }
                });
            });

            // View details button functionality
            document.querySelectorAll('.view-details-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const requestId = this.closest('.project-card').querySelector('.confirm-btn').getAttribute('data-request-id');
                    // You can implement the details modal functionality here
                    console.log(`View details for request ${requestId}`);
                    // Add your modal opening logic here
                });
            });
        });
    </script>
{% endblock content %}